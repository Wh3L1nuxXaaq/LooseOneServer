<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LooseOne | Личный кабинет</title>
  <link rel="stylesheet" href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css">
  <style>
    :root {
        --primary: #0e76fd;
        --primary-dark: #094bb2;
        --background: #0a0c10;
        --card-bg: #111317;
        --text: #dfe6ed;
        --text-secondary: #94a3b8;
        --accent: #3b82f6;
        --accent-hover: #2563eb;
        --success: #22c55e;
        --error: #ef4444;
        --highlight: #60a5fa;
    }

    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
        background-color: var(--background);
        color: var(--text);
        overflow-x: hidden;
        background-image: radial-gradient(circle at 25% 25%, rgba(121, 40, 202, 0.15) 0%, transparent 50%);
    }

    header {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        padding: 20px 10%;
        display: flex;
        justify-content: space-between;
        align-items: center;
        z-index: 1000;
        background: transparent;
        backdrop-filter: blur(10px);
        transition: all 0.3s ease;
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }

    header.sticky {
        padding: 15px 10%;
        background: rgba(10, 10, 12, 0.9);
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
    }

    .logotype {
        font-size: 28px;
        font-weight: 700;
        text-decoration: none;
        color: var(--text);
        background: linear-gradient(90deg, var(--primary), var(--accent));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        letter-spacing: 1px;
    }

    .links {
        display: flex;
        gap: 30px;
        list-style: none;
    }

    .links li a {
        text-decoration: none;
        color: var(--text);
        font-weight: 500;
        font-size: 16px;
        transition: all 0.3s ease;
        position: relative;
        padding: 5px 0;
    }

    .links li a::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        width: 0;
        height: 2px;
        background: var(--primary);
        transition: width 0.3s ease;
    }

    .links li a:hover::after {
        width: 100%;
    }

    .links li a:hover {
        color: var(--primary);
    }

    .profile-container {
        padding: 150px 10% 100px;
        display: flex;
        gap: 30px;
    }

    .profile-sidebar {
        width: 450px;
        background: var(--card-bg);
        border-radius: 10px;
        padding: 30px;
        border: 1px solid rgba(255, 255, 255, 0.05);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }

    .profile-avatar {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        background: var(--primary);
        margin: 0 auto 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 40px;
        font-weight: 700;
        color: white;
    }

    .profile-username {
        text-align: center;
        font-size: 22px;
        margin-bottom: 5px;
    }

    .profile-group {
        text-align: center;
        color: var(--primary);
        margin-bottom: 30px;
        font-weight: 600;
    }

    .profile-info {
        margin-bottom: 30px;
    }

    .profile-info-item {
        display: flex;
        justify-content: space-between;
        margin-bottom: 15px;
        padding-bottom: 15px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }

    .profile-info-label {
        color: var(--text-secondary);
    }

    .profile-info-value {
        word-wrap: break-word;
        white-space: normal;
        font-weight: 600;
        overflow: hidden;
        text-overflow: ellipsis;
        max-width: 100%;
        display: block;
        white-space: nowrap;
        text-overflow: ellipsis;
        overflow: hidden;
        -webkit-box-orient: vertical;
        -webkit-line-clamp: 1;
    }

    .profile-actions {
        display: flex;
        flex-direction: column;
        gap: 15px;
    }

    .btn {
        padding: 12px 20px;
        border-radius: 8px;
        text-decoration: none;
        font-weight: 600;
        font-size: 14px;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        text-align: center;
    }

    .btn-primary {
        background: var(--primary);
        color: white;
        box-shadow: 0 4px 15px rgba(7, 159, 214, 0.3);
    }

    .btn-primary:hover {
        background: var(--primary-dark);
        transform: translateY(-3px);
        box-shadow: 0 7px 20px rgba(7, 159, 214, 0.4);
    }

    .btn-secondary {
        background: var(--card-bg);
        color: var(--text);
        border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .btn-secondary:hover {
        background: rgba(255, 255, 255, 0.05);
        transform: translateY(-3px);
    }

    .profile-content {
        flex: 1;
        background: var(--card-bg);
        border-radius: 10px;
        padding: 30px;
        border: 1px solid rgba(255, 255, 255, 0.05);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }

    .section-title {
        font-size: 24px;
        margin-bottom: 25px;
        background: linear-gradient(90deg, var(--primary), var(--accent));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }

    .input-group {
        margin-bottom: 20px;
    }

    .input-label {
        display: block;
        margin-bottom: 8px;
        color: var(--text-secondary);
        font-size: 14px;
    }

    .input-field {
        width: 100%;
        padding: 12px 15px;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 8px;
        color: var(--text);
        font-size: 14px;
        transition: all 0.3s ease;
    }

    .input-field:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(14, 118, 253, 0.2);
    }

    .products-list {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 20px;
        margin-top: 20px;
    }

    .product-card {
        background: rgba(255, 255, 255, 0.03);
        border-radius: 8px;
        padding: 15px;
        border: 1px solid rgba(255, 255, 255, 0.05);
        transition: all 0.3s ease;
    }

    .product-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        border-color: rgba(7, 159, 214, 0.3);
    }

    .product-name {
        font-weight: 600;
        margin-bottom: 5px;
    }

    .product-date {
        color: var(--text-secondary);
        font-size: 12px;
    }

    .download-section {
        margin-top: 40px;
        padding-top: 30px;
        border-top: 1px solid rgba(255, 255, 255, 0.05);
    }

    .download-btn {
        width: 100%;
        padding: 15px;
        font-size: 16px;
    }

    @media (max-width: 992px) {
        .profile-container {
            flex-direction: column;
        }

        .profile-sidebar {
            width: 100%;
        }
    }

    @media (max-width: 768px) {
        header {
            padding: 15px 5%;
        }

        .links {
            gap: 15px;
        }

        .profile-container {
            padding: 120px 5% 80px;
        }
    }
  </style>
</head>
<body>
<header>
  <a href="index.html" class="logotype">LooseOne</a>
  <ul class="links">
    <li><a href="index.html">Главная</a></li>
    <li><a href="auth.html">Личный Кабинет</a></li>
    <li><a target="_blank" href="https://discord.gg/MmA2pr6hSj">Дискорд</a></li>
  </ul>
</header>

<div class="profile-container">
  <div class="profile-sidebar">
    <div class="profile-avatar">W</div>
    <h3 class="profile-username">Wh3L1nuxXaa</h3>
    <div class="profile-group" style="color: #22c55e;">Loading...</div>

    <div class="profile-info">
      <div class="profile-info-item">
        <span class="profile-info-label">UID:</span>
        <span class="profile-info-value">loading...</span>
      </div>
    </div>

    <div class="profile-actions">
      <a href="https://discord.gg/AYjDhzZ2xj" target="_blank" class="btn btn-primary"><i class='bx bxs-download'></i> Скачать лаунчер</a>
      <a href="https://discord.gg/MmA2pr6hSj" target="_blank" class="btn btn-secondary"><i class='bx bxs-support'></i> Поддержка</a>
      <a href="shop.html" class="btn btn-secondary"><i class='bx bxs-cart'></i> Купить подписку</a>
    </div>
  </div>

  <div class="profile-content">
    <h2 class="section-title">Активация ключа</h2>
    <div class="input-group">
      <label class="input-label">Введите ключ активации</label>
      <input type="text" class="input-field" id="activation-key" placeholder="XXXX-XXXX-XXXX-XXXX">
    </div>
    <div class="input-group">
      <label class="input-label">Введите HWID</label>
      <input type="text" class="input-field" id="activation-hwid" placeholder="HWID">
    </div>
    <button class="btn btn-primary" id="activate-btn">Активировать</button>
    <a href="https://looseone.space/huisasal/HWIDUtil.exe" target="_blank" class="btn btn-secondary" style="margin-left: 10px; margin-top: 10px;">Получить HWID</a>

    <h2 class="section-title" style="margin-top: 40px;">Купленные товары</h2>
    <div class="products-list">
      <div class="product-card">
        <div class="product-name">LooseOne RustEx (Навсегда)</div>
        <div class="product-date">Активирован до: 01.12.2031</div>
      </div>
      <div class="product-card">
        <div class="product-name">LooseOne Premium (Навсегда)</div>
        <div class="product-date">Активирован до: 01.12.2031</div>
      </div>
      <div class="product-card">
        <div class="product-name">LooseOne Remake (Навсегда)</div>
        <div class="product-date">Активирован до: 01.12.2031</div>
      </div>
    </div>

    <div class="download-section">
      <h2 class="section-title">Доступ к лаунчеру</h2>
      <p style="margin-bottom: 20px; color: var(--text-secondary);">Вы можете скачать лаунчер</p>
      <a href="https://discord.gg/AYjDhzZ2xj" target="_blank" class="btn btn-primary download-btn"><i class='bx bxs-download'></i> Скачать LooseOne Launcher</a>
    </div>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const activateBtn = document.getElementById("activate-btn");

    activateBtn.addEventListener("click", async function () {
      const activationKey = document.getElementById("activation-key").value.trim();
      const activationHWID = document.getElementById("activation-hwid").value.trim();
      const login = localStorage.getItem("looseone_login");
      const password = localStorage.getItem("looseone_password");

      if (!activationKey || !activationHWID) {
        alert("заполните все поля");
        return;
      }

      if (!login || !password) {
        alert("Ошибка авторизации. Перезайдите в аккаунт.");
        window.location.href = "auth.html";
        return;
      }

      try {
        const response = await fetch('/activate_penis', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            key: activationKey,
            login: login,
            hwid: activationHWID
          })
        });

        const data = await response.json();

        if (response.ok) {
          if (data.success) {
            alert("Ключ успешно активирован!");
            location.reload();
          } else {
            alert("Ошибка активации: " + (data.message || "Неизвестная ошибка."));
          }
        } else {
          alert("Ошибка сервера при активации.");
        }
      } catch (error) {
        alert("Ошибка подключения к серверу.");
        console.error("Ошибка сети: ", error);
      }
    });

    const header = document.querySelector("header");
    window.addEventListener("scroll", function () {
      header.classList.toggle("sticky", window.scrollY > 20);
    });

    const login = localStorage.getItem("looseone_login");
    const password = localStorage.getItem("looseone_password");

    if (!login || !password) {
      window.location.href = "auth.html";
      return;
    }

    const usernameElem = document.querySelector(".profile-username");
    if (usernameElem) usernameElem.textContent = login;

    const uidField = document.querySelectorAll('.profile-info-value')[0];
    async function fetchUIDByLogin(login, password) {
      try {
        const response = await fetch('/getuid_login', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ login, password })
        });

        const data = await response.json();
        uidField.textContent = "" + (data.uid || 'неизвестен');
      } catch (error) {
        uidField.textContent = 'Ошибка соединения';
        console.error("Ошибка запроса: ", error);
      }
    }

    const hwidField = document.createElement("div");
    hwidField.classList.add("profile-info-item");
    hwidField.innerHTML = `
      <span class="profile-info-label">HWID:</span>
      <span class="profile-info-value" id="hwid-value">Загрузка...</span>
    `;
    document.querySelector(".profile-info").appendChild(hwidField);

    async function fetchHWID(login, password) {
      try {
        const response = await fetch('/gethwid_login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ login, password })
        });
        const data = await response.json();
        const hwidValue = document.getElementById("hwid-value");
        if (response.ok) {
          hwidValue.textContent = data.hwid || 'неизвестен';
        } else {
          hwidValue.textContent = 'Ошибка загрузки HWID';
          console.error("Ошибка: ", data.error);
        }
      } catch (error) {
        document.getElementById("hwid-value").textContent = 'Ошибка соединения';
        console.error("Ошибка запроса: ", error);
      }
    }

    const groupElem = document.querySelector(".profile-group");
    async function fetchGroup(login, password) {
      try {
        const response = await fetch('/getgroup_login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ login, password })
        });
        const data = await response.json();
        if (response.ok) {
          groupElem.textContent = data.group || 'неизвестно';
          if (data.group === 'Разработчик') groupElem.style.color = '#22c55e';
          else if (data.group === 'Премиум') groupElem.style.color = '#f59e0b';
          else groupElem.style.color = '#3b82f6';
        } else {
          groupElem.textContent = 'Ошибка загрузки группы';
          console.error("Ошибка: ", data.error);
        }
      } catch (error) {
        groupElem.textContent = 'Ошибка соединения';
        console.error("Ошибка запроса: ", error);
      }
    }

    const productsList = document.querySelector(".products-list");

    async function fetchSubscriptions(login, password) {
      try {
        const response = await fetch('/get_subscriptions', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ login, password })
        });

        const data = await response.json();
        if (response.ok && data.subscriptions) {
          productsList.innerHTML = '';

          Object.entries(data.subscriptions).forEach(([product, date]) => {
            const card = document.createElement("div");
            card.classList.add("product-card");
            card.innerHTML = `
              <div class="product-name">LooseOne ${product}</div>
              <div class="product-date">Активирован до: ${date}</div>
            `;
            productsList.appendChild(card);
          });
        } else {
          productsList.innerHTML = '<p>Не удалось загрузить подписки.</p>';
          console.error("Ошибка: ", data.error);
        }
      } catch (error) {
        productsList.innerHTML = '<p>Ошибка соединения с сервером.</p>';
        console.error("Ошибка запроса: ", error);
      }
    }

    fetchSubscriptions(login, password);
    fetchUIDByLogin(login, password);
    fetchHWID(login, password);
    fetchGroup(login, password);
  });
</script>
</body>
</html>